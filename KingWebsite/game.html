<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>The Firm</title>
    <link rel="stylesheet" href="format.css"/>
</head>
<body>
    <img src="TheFirm.png" alt="The Firm Logo">
    <br>
    <button onclick="rules()">Rules</button>
    <button onclick="game()">Game</button>
    <div id="turn-indicator" style="margin:10px 0; font-weight:bold; font-size:2em;"></div>
    <div id="roll-window" style="margin: 15px 0; font-size: 1.5em; font-weight: bold; min-height: 2em;"></div>
    <div id="tile-result" style="margin:10px 0; font-weight:bold;"></div>
    <div id="tile-type" style="margin:10px 0; font-weight:bold;"></div>
    <button id="choose-normal-btn" style="display:none;" onclick="chooseNormalTile()">Normal Tile</button>
    <button id="choose-special-btn" style="display:none;" onclick="chooseSpecialTile()">Special Tile</button>
    <br><br>
    <button id="roll-btn" onclick="suspenseRoll(1, 6)">Roll Dice</button>
    <div id="dice-result" style="margin-bottom:10px; font-weight:bold;"></div>
    <input type="text" id="search" placeholder="Search tasks...."/>
    <table id="task-table">
        <thead>
            <tr>
                <th>Player</th>
                <th>Money</th>
                <th>Change</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
<script>
    function rules() {
        window.location.href = "rules.html";
    }
    function game() {
        window.location.href = "game.html";
    }

    let lastRoll = null;
    let landedTile = null; // "normal" or "special"

    function hideTileButtons() {
        document.getElementById("choose-normal-btn").style.display = "none";
        document.getElementById("choose-special-btn").style.display = "none";
    }

    function suspenseRoll(min, max, duration = 1500, interval = 80) {
        const rollDiv = document.getElementById('roll-window');
        rollDiv.innerHTML = `<div>Rolling number:</div><div id="rolling-num" style="font-size:2em"></div>`;
        document.getElementById("tile-type").textContent = "";
        document.getElementById("tile-result").textContent = "";
        let elapsed = 0;
        let rollingNumDiv = document.getElementById('rolling-num');
        document.getElementById("roll-btn").disabled = true;
        hideTileButtons();
        let rolling = setInterval(() => {
            const tempNum = Math.floor(Math.random() * (max - min + 1)) + min;
            rollingNumDiv.textContent = `${tempNum}`;
            elapsed += interval;
            if (elapsed >= duration) {
                clearInterval(rolling);
                const finalNum = Math.floor(Math.random() * (max - min + 1)) + min;
                lastRoll = finalNum;

                // Ask user which tile they landed on
                document.getElementById("tile-result").textContent = "Did you land on a Normal Tile or Special Tile?";
                document.getElementById("choose-normal-btn").style.display = "inline-block";
                document.getElementById("choose-special-btn").style.display = "inline-block";
            }
        }, interval);
    }

    function chooseNormalTile() {
        hideTileButtons();
        // 70% chance for money tile, 30% for event tile
        if (Math.random() < 0.7) {
            updatePlayerMoney(5);
            document.getElementById("tile-type").textContent = "Money Tile: You gain 5 money!";
        } else {
            document.getElementById("tile-type").textContent = "Event Tile: (Event logic not implemented yet)";
        }
        setTimeout(nextTurn, 1500);
    }

    function chooseSpecialTile() {
        hideTileButtons();
        updatePlayerMoney(5);
        document.getElementById("tile-type").textContent = "Special Tile: You gain 5 money and get an event! (Event logic not implemented yet)";
        setTimeout(nextTurn, 1800);
    }

    function updatePlayerMoney(amount) {
        if (typeof players !== "undefined") {
            players[currentPlayerIndex].change = amount.toString();
            players[currentPlayerIndex].money = (
                parseInt(players[currentPlayerIndex].money, 10) + amount
            ).toString();
            if (typeof playersTable === "function") {
                playersTable(players);
            }
        }
    }

    function nextTurn() {
        lastRoll = null;
        landedTile = null;
        hideTileButtons();
        document.getElementById("roll-btn").disabled = false;
        // Do NOT clear info windows here!
        // Advance to next player
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
        if (typeof playersTable === "function") {
            playersTable(players);
        }
    }

    window.onload = function() {
        if (typeof playersTable === "function" && typeof players !== "undefined") {
            playersTable(players);
        }
    };
</script>
<script src="table.js"></script>
</body>
</html>